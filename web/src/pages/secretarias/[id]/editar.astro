---
/**
 * Editar Secretaria - RF-004
 * Formulario de edici√≥n (sin campo Rol)
 */
import DashboardLayout from '../../../layouts/DashboardLayout.astro';
import Card from '../../../components/ui/Card.astro';
import Input from '../../../components/ui/Input.astro';
import Button from '../../../components/ui/Button.astro';
import { ESCUELA_ACTUAL } from '../../../lib/mockData';

export function getStaticPaths() {
  return [
    { params: { id: "1" } },
    { params: { id: "2" } },
    { params: { id: "3" } },
    { params: { id: "4" } },
    { params: { id: "5" } },
  ];
}

const { id } = Astro.params;

// Mock data
const secretarias: Record<string, any> = {
  '1': { id: 1, nombre: 'Patricia Secretaria', rut: '15.234.567-8', emailInstitucional: 'psecretaria@autoescuela-chillan.cl', emailPersonal: 'patsecretaria@gmail.com', telefono: '+56 9 8765 4321', sede: 'autoescuela-chillan', estado: 'activo' },
  '2': { id: 2, nombre: 'Mar√≠a Gonz√°lez',       rut: '16.789.012-3', emailInstitucional: 'mgonzalez@conductores-chillan.cl',  emailPersonal: 'mgonzalez.sec@gmail.com',   telefono: '+56 9 7654 3210', sede: 'conductores-chillan', estado: 'activo' },
  '3': { id: 3, nombre: 'Carmen Silva',         rut: '14.567.890-1', emailInstitucional: 'csilva@autoescuela-chillan.cl',      emailPersonal: 'carmen.silva@hotmail.com',  telefono: '+56 9 6543 2109', sede: 'autoescuela-chillan', estado: 'activo' },
  '4': { id: 4, nombre: 'Rosa P√©rez',           rut: '17.123.456-7', emailInstitucional: 'rperez@conductores-chillan.cl',      emailPersonal: 'rosa.perez.v@gmail.com',    telefono: '+56 9 5432 1098', sede: 'conductores-chillan', estado: 'inactivo' },
  '5': { id: 5, nombre: 'Ana Torres',           rut: '18.345.678-9', emailInstitucional: 'atorres@autoescuela-chillan.cl',     emailPersonal: 'ana.torres.sc@gmail.com',   telefono: '+56 9 4321 0987', sede: 'autoescuela-chillan', estado: 'activo' },
};

const secretaria = secretarias[id!] || secretarias['1'];
---

<DashboardLayout title={`Editar ${secretaria.nombre} - Escuela de Conductores`} escuela={ESCUELA_ACTUAL}>
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center gap-2 text-sm text-secondary mb-2">
      <a href="/dashboard" class="hover:text-gray-900">Inicio</a>
      <span>/</span>
      <a href="/secretarias" class="hover:text-gray-900">Secretarias</a>
      <span>/</span>
      <a href={`/secretarias/${id}`} class="hover:text-gray-900">{secretaria.nombre}</a>
      <span>/</span>
      <span class="text-gray-900 font-medium">Editar</span>
    </div>
    <h1 class="text-3xl font-semibold text-gray-900 tracking-tight">Editar secretaria</h1>
    <p class="text-secondary mt-1">Modificar informaci√≥n de {secretaria.nombre}</p>
  </div>

  <div class="grid lg:grid-cols-3 gap-6">
    <!-- Formulario -->
    <div class="lg:col-span-2">
      <Card>
        <h2 class="text-lg font-semibold text-gray-900 mb-6">Informaci√≥n de la secretaria</h2>
        <form id="editSecretariaForm" class="space-y-5" action={`/secretarias/${id}`} method="get">
          <!-- Nombre -->
          <Input label="Nombre completo" name="nombre" placeholder="Mar√≠a Gonz√°lez P√©rez" value={secretaria.nombre} required />

          <!-- RUT (solo lectura) -->
          <div class="w-full">
            <label class="block text-sm font-medium text-gray-700 mb-1.5" for="rut">
              RUT
            </label>
            <input
              type="text"
              id="rut"
              name="rut"
              value={secretaria.rut}
              disabled
              class="h-11 px-4 w-full text-sm bg-gray-100 rounded-md border border-gray-300 text-gray-600 cursor-not-allowed"
            />
            <p class="text-xs text-secondary mt-1.5">El RUT no se puede modificar</p>
          </div>

          <!-- Correo institucional (alias p√∫blico) -->
          <div class="w-full">
            <label class="block text-sm font-medium text-gray-700 mb-1.5" for="emailInstitucional">
              Correo institucional
              <span class="ml-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 text-blue-600 border border-blue-100">alias p√∫blico</span>
            </label>
            <input
              type="email"
              id="emailInstitucional"
              name="emailInstitucional"
              value={secretaria.emailInstitucional}
              required
              class="h-11 px-4 w-full text-sm bg-white rounded-md border border-gray-300 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-900"
            />
            <p class="text-xs text-secondary mt-1.5">Se muestra a alumnos y proveedores (no expone correo personal)</p>
          </div>

          <!-- Correo personal (login y auditor√≠a) -->
          <div class="w-full">
            <label class="block text-sm font-medium text-gray-700 mb-1.5" for="emailPersonal">
              Correo personal
              <span class="ml-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-gray-100 text-gray-500 border border-gray-200">login / auditor√≠a</span>
            </label>
            <input
              type="email"
              id="emailPersonal"
              name="emailPersonal"
              value={secretaria.emailPersonal}
              required
              class="h-11 px-4 w-full text-sm bg-white rounded-md border border-gray-300 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-900"
            />
            <p class="text-xs text-secondary mt-1.5">Correo de acceso al sistema y trazabilidad interna. Solo visible para administrador.</p>
          </div>

          <!-- Tel√©fono -->
          <Input label="Tel√©fono" name="telefono" type="tel" value={secretaria.telefono} required />

          <!-- Sede -->
          <div class="w-full">
            <label class="block text-sm font-medium text-gray-700 mb-1.5" for="sede">
              Sede asignada *
            </label>
            <select
              id="sede"
              name="sede"
              required
              class="h-11 px-4 w-full text-sm bg-white rounded-md border border-gray-300 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-900 appearance-none"
              style="background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E&quot;); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;"
            >
              <option value="autoescuela-chillan" selected={secretaria.sede === 'autoescuela-chillan'}>Autoescuela Chill√°n</option>
              <option value="conductores-chillan" selected={secretaria.sede === 'conductores-chillan'}>Conductores Chill√°n</option>
            </select>
          </div>

          <!-- Botones -->
          <div class="flex gap-3 pt-4 border-t border-gray-200">
            <a href={`/secretarias/${id}`} class="inline-flex items-center justify-center h-11 px-4 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-900 hover:bg-gray-50 hover:border-gray-400 shadow-sm transition-all duration-200">
              Cancelar
            </a>
            <Button type="submit" variant="primary">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Guardar cambios
            </Button>
          </div>
        </form>
      </Card>
    </div>

    <!-- Sidebar info -->
    <div class="space-y-4">
      <Card class="bg-blue-50 border-blue-200">
        <h3 class="text-sm font-semibold text-blue-900 mb-3">Rol asignado</h3>
        <div class="flex items-center gap-2 mb-2">
          <span class="text-lg">üìã</span>
          <p class="text-sm font-semibold text-blue-900">Secretaria</p>
        </div>
        <p class="text-xs text-blue-800">
          El rol no se puede modificar desde esta pantalla.
        </p>
      </Card>

      <Card class="bg-gray-50 border-gray-200">
        <h3 class="text-sm font-semibold text-gray-900 mb-3">Campos editables</h3>
        <ul class="space-y-2 text-xs text-gray-700">
          <li class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-gray-900 rounded-full shrink-0"></span>
            Nombre completo
          </li>
          <li class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-gray-900 rounded-full shrink-0"></span>
            Correo electr√≥nico
          </li>
          <li class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-gray-900 rounded-full shrink-0"></span>
            Tel√©fono de contacto
          </li>
          <li class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-gray-900 rounded-full shrink-0"></span>
            Sede asignada
          </li>
        </ul>
      </Card>

      <Card>
        <h3 class="text-sm font-semibold text-gray-900 mb-3">Nota</h3>
        <p class="text-xs text-gray-700">
          El RUT no se puede modificar por seguridad. Si necesitas cambiar el RUT, debes crear una nueva secretaria y desactivar esta.
        </p>
      </Card>
    </div>
  </div>
</DashboardLayout>

<script>
  // Submit handler
  const form = document.getElementById('editSecretariaForm') as HTMLFormElement;
  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const nombre = formData.get('nombre');
    alert(`‚úì Cambios guardados\n\nLa informaci√≥n de ${nombre} ha sido actualizada correctamente.\n\nRedirigiendo...`);
    window.location.href = form.action;
  });
</script>
