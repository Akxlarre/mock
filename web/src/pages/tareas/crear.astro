---
/**
 * Crear tarea (secretaría) o Asignar tarea a secretaría (admin).
 * Si ?asignar=1 → formulario de asignación (admin). Si no → crear tarea propia (secretaría).
 */
import DashboardLayout from "../../layouts/DashboardLayout.astro";
import Card from "../../components/ui/Card.astro";
import Button from "../../components/ui/Button.astro";
import Input from "../../components/ui/Input.astro";

const isAsignar = Astro.url.searchParams.get("asignar") === "1";
const title = isAsignar ? "Asignar tarea a secretaría" : "Crear tarea";
const breadcrumbParent = isAsignar ? "Tareas a secretaría" : "Dashboard";
const breadcrumbParentHref = isAsignar ? "/tareas" : "/secretaria/dashboard";

// Mock: secretarias para el select (admin)
const secretarias = [
  { id: "1", nombre: "Patricia Secretaria" },
  { id: "2", nombre: "Carmen López" },
];
---

<DashboardLayout
  title={title}
  userRole={isAsignar ? "admin" : "secretaria"}
  userName={isAsignar ? "Jorge Administrador" : "Patricia Secretaria"}
>
  <div class="mb-8">
    <div class="flex items-center gap-2 text-sm text-secondary mb-2">
      <a href={isAsignar ? "/dashboard" : "/secretaria/dashboard"} class="hover:text-gray-900">Inicio</a>
      <span>/</span>
      <a href={breadcrumbParentHref} class="hover:text-gray-900">{breadcrumbParent}</a>
      <span>/</span>
      <span class="text-gray-900 font-medium">{title}</span>
    </div>
    <h1 class="text-3xl font-semibold text-gray-900">{title}</h1>
    <p class="text-secondary mt-1">
      {isAsignar
        ? "Designe una nueva tarea y asígnela a una secretaria."
        : "Registre una tarea para su seguimiento."}
    </p>
  </div>

  <Card class="max-w-xl">
    <form class="space-y-4" action={isAsignar ? "/tareas" : "/secretaria/dashboard"} method="get">
      <Input
        label="Título de la tarea"
        name="titulo"
        placeholder="Ej. Validar documentos - María González"
        required
      />
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="detalle">
          Detalle (opcional)
        </label>
        <textarea
          id="detalle"
          name="detalle"
          rows="3"
          class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-1"
          placeholder="Indicaciones adicionales..."
        ></textarea>
      </div>
      {isAsignar && (
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="asignar_a">
            Asignar a
          </label>
          <select
            id="asignar_a"
            name="asignar_a"
            class="w-full min-h-11 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-1"
            required
          >
            <option value="">Seleccione secretaría</option>
            {secretarias.map((s) => (
              <option value={s.id}>{s.nombre}</option>
            ))}
          </select>
        </div>
      )}
      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          name="urgente"
          value="1"
          class="w-5 h-5 rounded border-gray-300 text-gray-900 focus:ring-gray-900"
        />
        <span class="text-sm font-medium text-gray-700">Marcar como urgente</span>
      </label>
      <div class="flex gap-3 pt-4">
        <a
          href={isAsignar ? "/tareas" : "/secretaria/dashboard"}
          class="inline-flex items-center justify-center min-h-11 px-4 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"
        >
          Cancelar
        </a>
        <Button type="submit" variant="primary">Guardar tarea</Button>
      </div>
    </form>
  </Card>
</DashboardLayout>
