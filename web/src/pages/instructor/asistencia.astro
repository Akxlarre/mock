---
/**
 * P√°gina: Asistencia del Instructor
 * Vista simplificada para que instructores vean y gestionen asistencia de sus clases
 */
import DashboardLayout from "../../layouts/DashboardLayout.astro";
import Card from "../../components/ui/Card.astro";
import Button from "../../components/ui/Button.astro";
import AttendanceStatusBadge from "../../components/attendance/AttendanceStatusBadge.astro";

// Mock data - En producci√≥n viene de API seg√∫n instructor_id
const instructorName = "Carlos Rojas";
const monthlyStats = {
    completedClasses: 89,
    totalClasses: 92,
    rate: 96.7,
};

const todayClasses = [
    {
        id: 1,
        time: "09:00",
        student: {
            name: "Ana Mart√≠nez",
            id: 101,
            classNumber: 8,
            totalClasses: 12,
        },
        status: "present",
        duration: 60,
        completed: true,
    },
    {
        id: 2,
        time: "11:00",
        student: {
            name: "Mar√≠a Gonz√°lez",
            id: 123,
            classNumber: 3,
            totalClasses: 12,
        },
        status: "in_progress",
        duration: 60,
        completed: false,
    },
    {
        id: 3,
        time: "14:00",
        student: {
            name: "Diego Torres",
            id: 104,
            classNumber: 5,
            totalClasses: 12,
        },
        status: "pending",
        duration: 60,
        completed: false,
    },
    {
        id: 4,
        time: "16:00",
        student: null,
        status: "pending",
        duration: 60,
        completed: false,
    },
];

const currentDate = new Date().toLocaleDateString("es-CL", {
    weekday: "long",
    day: "numeric",
    month: "long",
    year: "numeric",
});
---

<DashboardLayout title="Mi Asistencia - Instructor" userRole="instructor">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="mb-6">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">
                üë®‚Äçüè´ Mi Asistencia
            </h1>
            <p class="text-lg text-gray-600">
                {currentDate}
            </p>
        </div>

        <!-- Stats del Mes -->
        <Card class="p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">
                        Tasa de asistencia del mes
                    </p>
                    <p class="text-3xl font-bold text-green-600">
                        {monthlyStats.rate}%
                    </p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600 mb-1">Clases completadas</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        {monthlyStats.completedClasses}/{
                            monthlyStats.totalClasses
                        }
                    </p>
                </div>
            </div>
        </Card>

        <!-- Mis Clases de Hoy -->
        <Card class="p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">
                üìã Mis Clases de Hoy
            </h2>

            <div class="space-y-4">
                {
                    todayClasses.map((clase) => (
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-gray-300 hover:shadow-sm transition-all">
                            <div class="flex items-start justify-between gap-4">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-lg font-semibold text-gray-900">
                                            {clase.time}
                                        </span>
                                        {clase.student ? (
                                            <div>
                                                <p class="font-medium text-gray-900">
                                                    {clase.student.name}
                                                </p>
                                                <p class="text-sm text-gray-600">
                                                    Clase{" "}
                                                    {clase.student.classNumber}/
                                                    {clase.student.totalClasses}
                                                </p>
                                            </div>
                                        ) : (
                                            <p class="text-gray-400 italic">
                                                Cupo disponible
                                            </p>
                                        )}
                                    </div>

                                    <div class="flex items-center gap-3">
                                        <AttendanceStatusBadge
                                            status={clase.status}
                                            size="sm"
                                        />
                                        <span class="text-sm text-gray-500">
                                            {clase.duration} min
                                        </span>
                                    </div>
                                </div>

                                {clase.student && (
                                    <div class="flex gap-2 flex-shrink-0">
                                        {clase.status === "in_progress" && (
                                            <Button variant="primary" size="sm">
                                                Finalizar Clase
                                            </Button>
                                        )}
                                        {clase.status === "pending" && (
                                            <>
                                                <Button
                                                    variant="primary"
                                                    size="sm"
                                                >
                                                    Iniciar Clase
                                                </Button>
                                                <Button
                                                    variant="ghost"
                                                    size="sm"
                                                >
                                                    No Asisti√≥
                                                </Button>
                                            </>
                                        )}
                                        {clase.status === "present" && (
                                            <span class="text-sm text-green-600 font-medium">
                                                ‚úì Completada
                                            </span>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    ))
                }
            </div>
        </Card>

        <!-- Recordatorio -->
        <Card class="p-6 bg-blue-50 border-blue-200">
            <div class="flex gap-3">
                <span class="text-2xl flex-shrink-0">‚ÑπÔ∏è</span>
                <div>
                    <h3 class="font-semibold text-blue-900 mb-2">
                        ‚ö†Ô∏è Recordatorio Importante
                    </h3>
                    <p class="text-sm text-blue-800 mb-2">
                        Si el alumno no se presenta, marca "No asisti√≥" pasadas
                        2 horas del horario para el registro autom√°tico.
                    </p>
                    <p class="text-sm text-blue-900 font-medium">
                        üìå Pol√≠tica: 2 faltas consecutivas = Horario eliminado
                        autom√°ticamente
                    </p>
                </div>
            </div>
        </Card>

        <!-- Acciones R√°pidas -->
        <div class="mt-6 flex gap-3">
            <Button variant="ghost" href="/instructor/horario">
                Ver Mi Horario Completo
            </Button>
            <Button variant="ghost" href="/instructor/dashboard">
                Volver al Dashboard
            </Button>
        </div>
    </div>
</DashboardLayout>
