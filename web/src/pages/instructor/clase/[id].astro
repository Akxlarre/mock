---
/**
 * Clase Activa - Iniciar/Finalizar
 * Vista para instructor durante la clase
 */
import DashboardLayout from "../../../layouts/DashboardLayout.astro";
import Card from "../../../components/ui/Card.astro";
import Button from "../../../components/ui/Button.astro";

// Static paths for demo
export function getStaticPaths() {
    return [
        { params: { id: "1" } },
        { params: { id: "2" } },
        { params: { id: "3" } },
    ];
}

const { id } = Astro.params;

// Mock data - vendr√≠a de dynamic route [id]
const clase = {
    id: parseInt(id || "1"),
    tipo: "pr√°ctica",
    hora: "09:00",
    alumno: "Mar√≠a Gonz√°lez P√©rez",
    vehiculo: "ABC-123 (Suzuki Swift)",
    estado: "pending", // pending | started | completed
    duracion: 90,
    numeroClase: 5, // Clase 5 de 18
    totalClases: 18,
};
---

<DashboardLayout
    title="Clase - Instructor"
    userRole="instructor"
    userName="Carlos Rojas"
>
    <div class="max-w-3xl mx-auto">
        <!-- Breadcrumb -->
        <div class="flex items-center gap-2 text-sm text-secondary mb-6">
            <a href="/instructor/dashboard" class="hover:text-gray-900"
                >Dashboard</a
            >
            <span>/</span>
            <span class="text-gray-900 font-medium">Clase {clase.id}</span>
        </div>

        <!-- Estado actual -->
        <Card class="mb-6">
            <div class="text-center py-8">
                {
                    clase.estado === "pending" && (
                        <>
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg
                                    class="w-10 h-10 text-gray-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                    />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">
                                Clase Programada
                            </h2>
                            <p class="text-secondary">
                                Inicia la clase cuando est√©s listo
                            </p>
                        </>
                    )
                }
                {
                    clase.estado === "started" && (
                        <>
                            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                <svg
                                    class="w-10 h-10 text-blue-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z"
                                    />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-blue-600 mb-2">
                                Clase en Curso
                            </h2>
                            <p class="text-secondary">La clase est√° activa</p>
                        </>
                    )
                }
            </div>
        </Card>

        <!-- Detalles de la clase -->
        <Card class="mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                Detalles de la Clase
            </h3>

            <div class="space-y-4">
                <div
                    class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                    <span class="text-sm text-secondary">Tipo</span>
                    <span class="text-sm font-medium text-gray-900">
                        {
                            clase.tipo === "pr√°ctica"
                                ? "üöó Clase Pr√°ctica"
                                : "üìö Clase Te√≥rica"
                        }
                    </span>
                </div>

                <div
                    class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                    <span class="text-sm text-secondary">Hora</span>
                    <span class="text-sm font-medium text-gray-900"
                        >{clase.hora}</span
                    >
                </div>

                <div
                    class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                    <span class="text-sm text-secondary">Duraci√≥n</span>
                    <span class="text-sm font-medium text-gray-900"
                        >{clase.duracion} minutos</span
                    >
                </div>

                <div
                    class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                    <span class="text-sm text-secondary">Alumno</span>
                    <span class="text-sm font-medium text-gray-900"
                        >{clase.alumno}</span
                    >
                </div>

                <div
                    class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                    <span class="text-sm text-secondary">Veh√≠culo</span>
                    <span class="text-sm font-medium text-gray-900"
                        >{clase.vehiculo}</span
                    >
                </div>

                <div class="flex items-center justify-between py-3">
                    <span class="text-sm text-secondary">Progreso</span>
                    <span class="text-sm font-medium text-gray-900">
                        Clase {clase.numeroClase} de {clase.totalClases}
                    </span>
                </div>
            </div>

            <!-- Barra de progreso -->
            <div class="mt-4">
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div
                        class="bg-blue-600 h-2 rounded-full transition-all"
                        style={`width: ${(clase.numeroClase / clase.totalClases) * 100}%`}
                    >
                    </div>
                </div>
                <p class="text-xs text-secondary mt-1 text-center">
                    {Math.round((clase.numeroClase / clase.totalClases) * 100)}%
                    completado
                </p>
            </div>
        </Card>

        <!-- Acciones principales -->
        <div class="space-y-4">
            {
                clase.estado === "pending" && (
                    <Card class="bg-blue-50 border-blue-200 p-6">
                        <div class="flex items-start gap-4">
                            <svg
                                class="w-6 h-6 text-blue-600 flex-shrink-0 mt-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                />
                            </svg>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-blue-900 mb-1">
                                    ¬øListo para comenzar?
                                </p>
                                <p class="text-xs text-blue-800 mb-4">
                                    Al iniciar la clase, se registrar√° la hora
                                    de inicio y el estado se sincronizar√° con
                                    secretar√≠a
                                </p>
                                <Button
                                    variant="primary"
                                    class="w-full"
                                    onClick="iniciarClase()"
                                >
                                    <svg
                                        class="w-5 h-5 mr-2"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"
                                        />
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                        />
                                    </svg>
                                    Iniciar Clase Ahora
                                </Button>
                            </div>
                        </div>
                    </Card>
                )
            }

            {
                clase.estado === "started" && (
                    <Card class="bg-green-50 border-green-200 p-6">
                        <div class="flex items-start gap-4">
                            <svg
                                class="w-6 h-6 text-green-600 flex-shrink-0 mt-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                                />
                            </svg>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-green-900 mb-1">
                                    Clase en Curso
                                </p>
                                <p class="text-xs text-green-800 mb-4">
                                    Completa la ficha t√©cnica y finaliza la
                                    clase cuando termines
                                </p>
                                <Button
                                    href={`/instructor/ficha/${clase.id}`}
                                    variant="primary"
                                    class="w-full"
                                >
                                    <svg
                                        class="w-5 h-5 mr-2"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                        />
                                    </svg>
                                    Completar Ficha T√©cnica y Finalizar
                                </Button>
                            </div>
                        </div>
                    </Card>
                )
            }

            <!-- Bot√≥n cancelar/volver -->
            <div class="flex gap-3">
                <Button
                    href="/instructor/dashboard"
                    variant="ghost"
                    class="flex-1"
                >
                    Volver al Dashboard
                </Button>
                {
                    clase.estado === "started" && (
                        <Button
                            variant="secondary"
                            class="flex-1"
                            onClick="cancelarClase()"
                        >
                            Cancelar Clase
                        </Button>
                    )
                }
            </div>
        </div>
    </div>
</DashboardLayout>

<script>
    function iniciarClase() {
        // Simular inicio de clase
        if (confirm("¬øConfirmas que deseas iniciar esta clase?")) {
            alert(
                '‚úì Clase iniciada correctamente. En producci√≥n se registrar√≠a el timestamp y cambiar√≠a el estado a "started".',
            );
            // Aqu√≠ ir√≠a la llamada API para cambiar estado
            window.location.reload();
        }
    }

    function cancelarClase() {
        const motivo = prompt("Motivo de cancelaci√≥n:");
        if (motivo) {
            alert("‚úì Clase cancelada. Motivo: " + motivo);
            // Aqu√≠ ir√≠a la llamada API
            window.location.href = "/instructor/dashboard";
        }
    }

    // Make functions global
    (window as any).iniciarClase = iniciarClase;
    (window as any).cancelarClase = cancelarClase;
</script>

<style>
    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }

    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
</style>
